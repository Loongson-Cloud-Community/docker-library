# This file is generated by the template.

REGISTRY	?=lcr.loongnix.cn
ORGANIZATION	?=vmware-tanzu
REPOSITORY	?=velero
TAG		?=1.16.1
LATEST		?=true

IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):$(TAG)
LATEST_IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):latest
SOURCE_URL=https://github.com/vmware-tanzu/velero.git
PATCH_velero=0001-add-loong64-support-for-velero.patch
PATCH_kopia=0001-add-loong64-support-for-kopia.patch

default: image

image: SOURCE
	@cd velero;\
	make container-linux-loong64;\
	cd -

SOURCE:
	@git clone $(SOURCE_URL) -b v1.16.1 --depth=1; \
		cd velero; \
		go mod tidy; \
		go mod vendor; \
		patch -p1 < ../$(PATCH_velero);\
		patch -p1 < ../$(PATCH_kopia)


push:
	docker push lcr.loongnix.cn/velero/velero:release-1.16-dev-linux-loong64
	#latest image

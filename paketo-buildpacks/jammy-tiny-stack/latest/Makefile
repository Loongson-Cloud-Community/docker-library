# This file is generated by the template.

REGISTRY	?=lcr.loongnix.cn
ORGANIZATION	?=paketo-buildpacks
REPOSITORY	?=jammy-tiny-stack
TAG		?=latest
LATEST		?=true

IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):$(TAG)
LATEST_IMAGE=$(REGISTRY)/$(ORGANIZATION)/$(REPOSITORY):latest
URL=https://github.com/paketo-buildpacks/jammy-tiny-stack.git

default: image

image: SOURCE
	@cd jammy-tiny-stack/stack/run;\
	docker build \
		--build-arg packages="base-files ca-certificates libc6 libssl3t64 netbase openssl tzdata zlib1g" \
		--build-arg http_proxy=$(http_proxy) \
		--build-arg https_proxy=$(https_proxy) \
		-t $(REGISTRY)/paketobuildpacks/run-jammy-tiny:latest -f run.Dockerfile \
		.

SOURCE:
	@git clone $(URL) --depth=1 ;\
		cd jammy-tiny-stack; \
		patch -p1 < ../0001-add-loong64-support-for-jammy-tiny-stack.patch


push:
	docker push $(REGISTRY)/paketobuildpacks/run-jammy-tiny:latest
